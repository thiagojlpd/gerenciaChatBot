<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot de Detonação</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap');
        @import url('https://fonts.googleapis.com/icon?family=Material+Icons');

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to right, #e0f2f1, #f5f5f5);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
            flex-direction: column;
        }

        h2 {
            font-size: 24px;
            color: #024940;
            margin-bottom: 20px;
        }

        #chatbox {
            position: relative;
            width: 100%;
            max-width: 600px;
            /* Limita o tamanho máximo */
            height: 420px;
            border-radius: 12px;
            background-color: #fff;
            padding: 24px;
            overflow-y: auto;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            gap: 16px;
            animation: fadeIn 0.5s ease;
        }

        button {
            background-image: linear-gradient(to right, #80CBC4, #68a49e);
            color: white;
            font-size: 16px;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px;
            margin-top: 10px;
            transition: all 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background-image: linear-gradient(to right, #80CBC4, #71afa9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: scale(0.98);
        }

        #userInput {
            width: 100%;
            /* Garante que o input ocupe toda a largura do chatbox */
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-top: 10px;
            box-sizing: border-box;
            transition: all 0.3s ease-in-out;
        }

        #userInput:focus {
            border-color: #00796b;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.2);
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .user-message,
        .bot-message {
            margin-bottom: 8px;
            padding: 12px 16px;
            border-radius: 10px;
            max-width: 100%;
            word-wrap: break-word;
            backdrop-filter: blur(6px);
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: auto;
            min-width: 50%;
            /* Garante que as mensagens não fiquem muito pequenas */
            max-width: 80%;
            /* Limita o máximo para não ultrapassar o tamanho da tela */
            box-sizing: border-box;
            /* Garante que o padding não afete o tamanho total */
        }

        /* Responsividade para a largura das mensagens */
        @media (max-width: 768px) {

            .user-message,
            .bot-message {
                width: 90%;
                /* Torna as mensagens mais largas em telas menores */
                padding: 10px 14px;
            }
        }

        @media (max-width: 480px) {

            .user-message,
            .bot-message {
                width: 95%;
                /* Ajuste para telas ainda menores */
                padding: 8px 12px;
            }
        }


        .user-message {
            background-color: #80CBC4;
            color: white;
            align-self: flex-end;
            border-left: 4px solid #4db6ac;
            animation: slideInRight 0.5s ease;
        }

        .bot-message {
            background-color: #eeeeee;
            color: #333;
            align-self: flex-start;
            border-left: 4px solid #ccc;
            animation: slideInLeft 0.5s ease;
        }

        .user-message:hover {
            background-image: linear-gradient(135deg, #4db6ac, #80CBC4);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .bot-message:hover {
            background-image: linear-gradient(135deg, #e9e8e8, #e8e8e8);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(30px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            0% {
                opacity: 0;
                transform: translateX(-30px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .follow-up {
            font-style: italic;
            color: #00796b;
            margin-top: 10px;
        }

        @keyframes floatPulse {

            0%,
            100% {
                transform: scale(1) translateY(0);
            }

            50% {
                transform: scale(1.1) translateY(-2px);
            }
        }

        .emoji-bot {
            display: inline-block;
            animation: floatPulse 1.5s ease-in-out infinite;
        }

        .info-button {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background-color: #007BFF;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .info-button .info-tooltip {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 10px;
            width: 260px;
            position: absolute;
            z-index: 999;
            top: 30px;
            right: 0;
            opacity: 0;
            transform: translateY(5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            font-size: 13px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 9999;
        }

        .info-button:hover .info-tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            h2 {
                font-size: 20px;
            }

            #chatbox {
                width: 95%;
                height: 350px;
                padding: 16px;
            }

            button {
                font-size: 14px;
                padding: 8px 16px;
            }

            #userInput {
                font-size: 14px;
            }

            .user-message,
            .bot-message {
                padding: 10px 14px;
            }

            .info-button {
                width: 20px;
                height: 20px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            #chatbox {
                width: 100%;
                height: 300px;
            }

            button {
                font-size: 12px;
                padding: 6px 12px;
            }

            #userInput {
                font-size: 14px;
            }

            .user-message,
            .bot-message {
                padding: 8px 12px;
            }
        }
    </style>



</head>

<body>

    <!-- Container principal do chatbot -->
    <div id="principal">

        <!-- Título da interface do chatbot -->
        <h2>Chatbot para pesquisa a perguntas frequentes</h2>

        <!-- Área onde as mensagens do chatbot e do usuário serão exibidas -->
        <div id="chatbox">
            <!-- Botão "i" com tooltip, posicionado no canto superior direito -->
            <button class="info-button" title="Informações sobre o funcionamento do chatbot">
                i
                <span class="info-tooltip">
                    <strong>ℹ️ Técnicas utilizadas no Chatbot:</strong><br><br>
                    • Busca com tokenização;<br>
                    • Busca com exclusão de palavras menores que 02 caracteres (bad words);<br>
                    • Busca fuzzy match com algoritmo de Levenshtein (busca por similaridade);<br>
                    • Exibe a melhor resposta + 02 similares;<br>
                    • Aceita perguntas abertas ou a escolha de tópicos.
                </span>
            </button>
        </div>

        <!-- Campo de entrada de texto para o usuário digitar perguntas -->
        <input type="text" id="userInput" placeholder="Digite sua pergunta...">

        <!-- Botão que aciona a função de envio da pergunta -->
        <span style="display: inline-flex; gap: 8px;">
            <button onclick="sendMessage()">Enviar</button>
            <button id="showFeedbacksBtn" onclick="showUserFeedbacks()">Feedbacks</button>
        </span>

    </div>




    <script>
        // Objeto contendo regras organizadas por categorias com perguntas e respostas
        const rules = {
            "Responsável Técnico da Detonação": {
                "Quem pode ser o responsável técnico pela detonação?": "São aceitos como responsável técnico: engenheiro de minas, engenheiro civil, geólogo, técnico em mineração, que devem possuir registro no CREA /CRT.",
                "O responsável técnico pela detonação deve ter vínculo com a contratante ou contratada?": "O responsável técnico designado na autorização de detonação deve ter vínculo com a empresa responsável pela detonação.",
                "Quem deve assinar a ART ou CRT?": "O responsável pela ART/CRT deve ser o mesmo responsável pelo serviço de detonação descrito no requerimento da autorização do serviço de detonação.",
                "A ART pode ser assinada por profissional de outras regiões do país (CREA MG, RJ etc.)?": "Sim, desde que ele tenha vínculo com a empresa executante do serviço de detonação."
            },
            "Autorização de Detonação": {
                "Quem presta o serviço de detonação para terceiros (contratado) precisa possuir registro? E com qual atividade no registro?": "O prestador do serviço de detonação (contratado) deve possuir registro, especificamente com a atividade de 'prestação de serviço de detonação'.",
                "Quem contrata o serviço de detonação precisa possuir registro? E com qual atividade no registro?": "Quem contrata o serviço (contratante) precisa ter registro com a atividade 'utilização - aplicação de explosivos' (somente de forma terceirizada)."
            },
            "Autorização para Aquisição de Explosivos": {
                "Quando deve ser requerida a 'autorização para aquisição de explosivos'?": "A 'autorização para aquisição de explosivos' deve ser solicitada, e se faz necessária sempre que houver a aquisição dos explosivos classificados nos grupos de ordem 3.1, 3.3 e 3.4.",
                "O que é necessário para requerer a 'autorização para aquisição de explosivos'?": "Para a aquisição de explosivos, é necessário registro com atividade que pressuponha a aquisição e com a atividade de armazenamento apostilada."
            },
            "Comércio Exterior": {
                "O que acontece quando se dá uma importação de PCE sem a devida autorização prévia da DFPC?": "<br><br><i>Art. 43. O embarque de mercadoria sem autorização, exceto para os órgãos enquadrados na modalidade de licenciamento automático, trará, dentre outras, as seguintes consequências:<br/>I. Indeferimento da licença de importação com restrição de data de embarque;<br/>II. Indeferimento da licença de importação: e/ou<br/>III. Instauração de processo administrativo, a cargo da Região Militar com circunscrição sobre o local de desembarque do produto</i>. ",
                "O que é a autorização prévia para importação?": "Para pessoas físicas, trata-se do Certificado Internacional de Importação (CII) e da Licença Simplificada de Importação (LSI) ou Licença de Importação (LI). <br/> Para pessoas jurídicas, trata-se da Licença de Importação (LI). Sobre o assunto, convém aduzir aos § 1.º e 2.º do Art. 7 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019:<br><br><i>Art. 7º. Para a obtenção da autorização prévia para a importação, o interessado, pessoa física ou jurídica, deverá encaminhar requerimento (Anexo A ou B) ao Diretor de Fiscalização de Produtos controlados, autoridade militar a qual fica delegada a competência para a emissão do ato, sob a supervisão do Comando Logístico.<br/>§ 1º A autorização prévia será concedida pela DFPC, por meio da emissão do Certificado Internacional de Importação – CII (Anexo C);<br/>§ 2º A autorização prévia poderá também ser concedida diretamente na Licença de Importação (LI) gerada no SISCOMEX, neste caso, caracterizada pela mudança do status para: “Embarque autorizado” ou “Deferido”, conforme art. 37 do Decreto nº 10.030, de 30 de setembro de 2019</i>.",
                "Quais os órgãos que se enquadram no licenciamento automático?": "<br><br>Aqueles que constam no art. 34 do Decreto nº 9.847, de 25 de junho 2019:<br><br><i>Art. 34º.  O Comando do Exército autorizará a aquisição e a importação de armas de fogo, munições e demais produtos controlados, mediante prévia comunicação, para os seguintes órgãos, instituições e corporações: I. a Polícia Federal;<br>II. a Polícia Rodoviária Federal;<br>III. Gabinete de Segurança Institucional da Presidência da República;<br>IV. Agência Brasileira de Inteligência;<br>V. o Departamento Penitenciário Nacional;<br>VI. Força Nacional de Segurança Pública, por meio da Secretaria Nacional de Segurança Pública;<br>VII. os órgãos policiais da Câmara dos Deputados e do Senado Federal a que se referem, respectivamente, o  inciso IV do caput do art. 51 e o  inciso XIII do  caput do art. 52 da Constituição;<br>VIII. as polícias civis dos Estados e do Distrito Federal;<br>IX. as polícias militares dos Estados e do Distrito Federal;<br>X. os corpos de bombeiros militares dos Estados e do Distrito Federal; e<br>XI. as guardas municipais</i>.",
                "Como corrigir dados incorretos em uma operação já cadastrada no sistema?": "<br><br>Caso identifique erro após o cadastro da operação, utilize a funcionalidade 'Editar Operação' no SISCOFIS. Se a operação já tiver sido enviada para análise, será necessário abrir uma solicitação de retificação junto à área responsável com justificativa e documentos de suporte."
            },
            "SisGCorp": {
                "Como obtenho informações gerais sobre o SisGCorp para o público externo?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/municao' target='_blank'>Clique aqui</a>",
                "Como obtenho informações sobre os tutoriais de uso do SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/noticias-menu/736-sisgcorp-tutoriais' target='_blank'>Clique aqui</a>",
                "Quais são as solicitações que podem ser requisitadas no SisGCorp?": "Concessão de registro para pessoa física - CAC, revalidação para pessoa física, apostilamento CR PF - atualização tipo atividade e tipo PCE, apostilamento CR PF - inclusão de 2º endereço acervo, apostilamento CR PF - atualização de endereço do acervo, apostilamento CR PF - atualização doc identificação pessoal, cancelamento para pessoa física, autorização para aquisição de PCE no mercado nacional, registro e apostilamento de armas de CAC e emitir guia de tráfego pessoa física CAC. Os demais processos serão protocolados fisicamente, seguindo a documentação constante do catálogo de serviço constante no Porta SFPC na Internet e com agendamento prévio (<a href='http://portalsfpc.2rm.eb.mil.br/index.php/agendar-atendimento' target='_blank'>Clique aqui</a>).",
                "Como solicitar concessão de registro para pessoa física - CAC no SisGCorp?": "Acesse endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/623-concessao-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>.",
                "Como solicitar revalidação para pessoa física no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/625-revalidacao-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>",
                "Como solicitar apostilamento CR PF - atualização tipo atividade e tipo PCE no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>",
                "Como solicitar apostilamento CR PF - inclusão de 2º endereço acervo no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>",
                "Como solicitar apostilamento CR PF - atualização de endereço do acervo no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>",
                "Como solicitar apostilamento CR PF - atualização doc identificação pessoal no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>",
                "Como solicitar cancelamento para pessoa física no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/650-cancelamento-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>",
                "Como solicitar autorização para aquisição de PCE no mercado nacional no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/626-aquisicoes-cac' target='_blank'>Clique aqui</a>",
                "Como solicitar registro e apostilamento de armas de CAC no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/645-registro-orientacoes-gerais' target='_blank'>Clique aqui</a>",
                "Como solicitar emitir guia de tráfego pessoa física CAC no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/tutoriaisSisGCorp/Manual_Guia_de_Trafego.pdf' target='_blank'>Clique aqui</a>",
                "Qual é o prazo para a análise do processo no SisGCorp?": "O SFPC/2 não define nem informa previsão de prazo para análises de processos, mas submete-se àquele citado no art. 57 do Decreto nº 9.847/19. Ressalta-se, ademais, que todos os processos tramitados pelo SFPC/2 seguem a estrita ordem cronológica de protocolo, preservando-se a devida isonomia, e estão sujeitos necessariamente à demanda de entrada.",
                "O que significa restituição de processo no SisGCorp?": "Visando a objetividade e tempestividade, o analista informará todas as pendências no processo de uma só vez ao interessado, justificando-se exigência posterior apenas em caso de dúvida superveniente. O usuário, reciprocamente, terá uma só oportunidade, por prazo expressamente definido, para solução das pendências informadas pelo analista. Assim, após uma primeira restituição no SisGCorp, o encaminhamento de processo sem a solução integral de todas as pendências, implicará seu imediato indeferimento, sem nova oportunidade de solução. Questionamentos sobre pendências em processos devem ser feitos exclusivamente via requerimento físico, com a exposição e a argumentação necessárias, devidamente assinado pelo interessado, com protocolo na Organização Militar da sua área de vinculação (Acesse o endereço: <a href='http://portalsfpc.2rm.eb.mil.br/index.php/servicos-da-denominacao' target='_blank'>Clique aqui</a>).",
                "O que significa indeferimento do processo no SisGCorp?": "Visando a objetividade e tempestividade, o analista informará todas as pendências no processo de uma só vez ao interessado, justificando-se exigência posterior apenas em caso de dúvida superveniente. O usuário, reciprocamente, terá uma só oportunidade, por prazo expressamente definido, para solução das pendências informadas pelo analista. Assim, após uma primeira restituição no SisGCorp, o encaminhamento de processo sem a solução integral de todas as pendências, implicará seu imediato indeferimento, sem nova oportunidade de solução. Pedidos de reconsideração de indeferimento de processos devem ser feitos exclusivamente via requerimento físico, com a exposição e a argumentação necessárias, devidamente assinado pelo interessado, com protocolo na Organização Militar da sua área de vinculação (Acesse o endereço: <a href='http://portalsfpc.2rm.eb.mil.br/index.php/servicos-da-denominacao' target='_blank'>Clique aqui</a>). A Administração pode indeferir sem dar prazo para cumprimento de pendência quando julgar cabível, por exemplo, certidão do TJSP desacompanhada de certidão de objeto e pé e processo criminal já verificado pelo analista no site do Tribunal.",
                "Quais são as documentações obrigatórias em processos de concessão de registro para pessoa física - CAC no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/623-concessao-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de revalidação para pessoa física no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/625-revalidacao-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de apostilamento CR PF - atualização tipo atividade e tipo PCE no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/623-concessao-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de apostilamento CR PF - inclusão de 2º endereço acervo no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de apostilamento CR PF - atualização de endereço do acervo no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/649-apostilamento-ao-registro-colecionador-atirador-desportivo-e-cacador-2' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de cancelamento para pessoa física no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/650-cancelamento-de-registro-colecionador-atirador-desportivo-e-cacador' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de aquisição de PCE no mercado nacional no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/aquisicoes' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de registro e apostilamento de armas de CAC no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/645-registro-orientacoes-gerais' target='_blank'>Clique aqui</a>.",
                "Quais são as documentações obrigatórias em processos de emitir guia de tráfego pessoa física CAC no SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/tutoriaisSisGCorp/Manual_Guia_de_Trafego.pdf' target='_blank'>Clique aqui</a>.",
                "Como envio comentários, críticas ou sugestões relativos ao SisGCorp?": "Acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/noticias-menu' target='_blank'>Clique aqui</a>."
            },
            "Jurídico": {
                "Como faço pedido de restituição de taxa (GRU) não usada em processo?": "Para pedir restituição de taxa não usada em processo, acesse o endereço DFPC: <a href='http://www.dfpc.eb.mil.br/index.php/conteudo-do-menu-superior/31-dados-abertos/633-restituicao-de-taxa-de-fiscalizacao-de-produtos-controlados' target='_blank'>Clique aqui</a>. O Comando da 2ª Região Militar é responsável apenas pelo parecer e encaminhamento do processo à DFPC, que após reanalisar encaminhará para a Diretoria de Gestão Orçamentária (DGO), que é a responsável pelo ressarcimento. O requerente poderá acompanhar seu processo através do número do Diex informado no Sisprot."
            },
            "Comércio Exterior": {
                "O que acontece quando se dá uma importação de PCE sem a devida autorização prévia da DFPC?": "A importação será indeferida conforme o art. 43 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019:\nArt. 43. O embarque de mercadoria sem autorização, exceto para os órgãos enquadrados na modalidade de licenciamento automático, trará, dentre outras, as seguintes consequências:\nI. Indeferimento da licença de importação com restrição de data de embarque;\nII. Indeferimento da licença de importação: e/ou\nIII. Instauração de processo administrativo, a cargo da Região Militar com circunscrição sobre o local de desembarque do produto.",
                "O que é a autorização prévia para importação?": "Para pessoas físicas, trata-se do Certificado Internacional de Importação (CII) e da Licença Simplificada de Importação (LSI) ou Licença de Importação (LI). Para pessoas jurídicas, trata-se da Licença de Importação (LI). Sobre o assunto, convém aduzir aos § 1.º e 2.º do Art. 7 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019:\nArt. 7º. Para a obtenção da autorização prévia para a importação, o interessado, pessoa física ou jurídica, deverá encaminhar requerimento (Anexo A ou B) ao Diretor de Fiscalização de Produtos controlados, autoridade militar a qual fica delegada a competência para a emissão do ato, sob a supervisão do Comando Logístico.\n§ 1º A autorização prévia será concedida pela DFPC, por meio da emissão do Certificado Internacional de Importação – CII (Anexo C);\n§ 2º A autorização prévia poderá também ser concedida diretamente na Licença de Importação (LI) gerada no SISCOMEX, neste caso, caracterizada pela mudança do status para: “Embarque autorizado” ou “Deferido”, conforme art. 37 do Decreto nº 10.030, de 30 de setembro de 2019.",
                "Quais os órgãos que se enquadram no licenciamento automático?": "Aqueles que constam no art. 34 do Decreto nº 9.847, de 25 de junho 2019:\nArt. 34º. O Comando do Exército autorizará a aquisição e a importação de armas de fogo, munições e demais produtos controlados, mediante prévia comunicação, para os seguintes órgãos, instituições e corporações:\nI. a Polícia Federal;\nII. a Polícia Rodoviária Federal;\nIII. Gabinete de Segurança Institucional da Presidência da República;\nIV. Agência Brasileira de Inteligência;\nV. o Departamento Penitenciário Nacional;\nVI. Força Nacional de Segurança Pública, por meio da Secretaria Nacional de Segurança Pública;\nVII. os órgãos policiais da Câmara dos Deputados e do Senado Federal a que se referem, respectivamente, o inciso IV do caput do art. 51 e o inciso XIII do caput do art. 52 da Constituição;\nVIII. as polícias civis dos Estados e do Distrito Federal;\nIX. as polícias militares dos Estados e do Distrito Federal;\nX. os corpos de bombeiros militares dos Estados e do Distrito Federal; e\nXI. as guardas municipais.",
                "Como realizar importação de arma de airsoft?": "Por meio de CII no caso de pessoa física (pedido exclusivamente por meio do Sisgcorp); Por meio de CII e/ou LI no caso de pessoa jurídica.",
                "É necessária alguma autorização do Exército para que um atirador desportivo, devidamente registrado no Exército, em virtude de competição desportiva no estrangeiro, retorne trazendo, em sua bagagem, arma de fogo/peças e munições de seu acervo?": "Os procedimentos relativos a autorização para exportação temporária de PCE objeto da atividade de tiro desportivo, para uso em competições desportivas no estrangeiro, constam dos art. 89 e 90 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019.",
                "Há necessidade de informar os dados de luneta em termo de vistoria relativo a arma de fogo?": "Não há necessidade, pois luneta não é mais enquadrada como PCE.",
                "Na fatura comercial internacional (invoice), é necessário fazer constar o número de série de cada PCE a ser importado?": "Sim, há necessidade.",
                "Além da guia de tráfego (GT) provisória (relativa ao trânsito de PCE do local de chegada até o local de acervo), o requerente vinculado à 2ª Região Militar pode solicitar, em simultâneo, a GT definitiva (treinamento/competição) dos PCE que serão importados por ele?": "Sim, desde que também se apresente, no corpo do processo, o requerimento específico para tal GT definitiva, acompanhado do comprovante de pagamento da devida taxa.",
                "Arma de fogo pode ser importada por meio de remessa postal?": "Não. Conforme o art. 71 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019, é vedada a importação, por meio de remessa postal ou similar, de arma de fogo.",
                "Munições podem ser importadas por meio de remessa postal?": "Não. Conforme o art. 71 da Portaria nº 1.729 Cmt EB, de 29 de outubro de 2019, é vedada a importação, por meio de remessa postal ou similar, de munição e seus componentes.",
                "Carregador de arma de fogo é considerado PCE?": "Carregador de arma de fogo não é PCE, conforme estabelece o inciso IV do §3º do art. 2º do Decreto nº 10.030, de 30 de setembro de 2019. Entretanto, é proibida a importação e o comércio de carregadores de pistolas com capacidade igual ou superior a 20 (vinte) cartuchos, conforme exposto no art 1º da PORTARIA Nº 001 – D Log, de 30 de Janeiro de 2001.",
                "Como deve ser apresentada uma procuração ou um subestabelecimento?": "Deverá ser entregue o original assinado e acompanhado de cópia do documento de identificação do outorgado.",
                "O que deve constar no campo 'Número de Referência' da GRU (Guia de Recolhimento da União) nos processos de importação por bagagem desacompanhada, bagagem acompanhada e remessa postal?": "Devem constar os seguintes códigos: 20253 - Desembaraço alfandegário; 20265 - Autorização de Importação por CII Pessoa Jurídica; 20227 - Emissão de Guia de Tráfego; 20271 - Registro de arma de fogo; e 20224 - Apostilamento de Pessoa Física.",
                "O que deve constar no campo 'Número de Referência' da GRU nos processos de importação e exportação por pessoa jurídica?": "Deve constar o número da Licença de Importação (LI) para os casos de importação, e para exportação deve constar o número da LPCO.",
                "O que fazer quando um processo de Licença de Importação (LI) é indeferido?": "Deve-se iniciar um novo processo.",
                "Há necessidade de apresentar o requerimento para inspeção nas importações de produto classificado na faixa vermelha?": "Sim. O requerimento para inspeção (Anexo I da Portaria 1729) é documento imprescindível conforme art 55 da referida portaria.",
                "Quando e à quem solicitar vistoria de uma importação?": "Conforme procedimentos constantes no portal SFPC/2, a vistoria é autorizada após análise inicial da documentação. O requerente deverá solicitar a vistoria por e-mail, de acordo com o exposto na etapa 3 do processo de comércio exterior no portal deste SFPC. Após realização, inserir o termo lavrado no portal único e utilizar o mesmo protocolo inicial para cumprimento de pendência no SISPROT.",
                "Arma de fogo importada chegou com marcações diferentes entre cano, ferrolho e armação. Terei algum empedimento?": "Conforme Portaria nº 213-COLOG/CEx, de 2021, em seu art. 4º informa que o número de série, por óbvio, deve ser o mesmo para todas as peças da arma, inclusive o ferrolho (ou culatra) dos conversores de calibre e os canos das armas multicalibre, conforme §3º e §4º do referido artigo. Nestes casos de marcações divergentes, o processo será indeferido e as armas terão que retornar ao país de origem.",
                "Produto classificado na faixa verde, devo solicitar desembaraço na minha Região Militar?": "Negativo. Conforme parágrafo único do art 40 da portaria 1729: 'Os pedidos de licença de importação de PCE incluídos na faixa verde, conforme art. 52, serão ‘deferidos’ pela DFPC após a análise e verificada a regularidade da operação, sendo dispensada a autorização de embarque.'",
                "Meu produto é classificado na faixa amarela. Terei que realizar vistoria?": "Conforme item II do art 52 da Portaria Colog 1729, a inspeção física da mercadoria será feita por amostragem, de acordo com a frequência julgada adequada pelo fiscal militar responsável.",
                "Preciso realizar um cumprimento de pendência no sistema SISPROT. Posso abrir outro protocolo?": "Negativo. Conforme instruído nos processos constantes no portal SFPC/2, é preciso cumprir pendência no mesmo protocolo inicial.",
                "End-User: Posso pedir para meu importador emitir uma declaração atestando que ele é o usuário final do produto?": "Não. Conforme item iv do artigo 4º do Decreto 9607, de 12 de dezembro de 2018, note que precisa ser emitido por órgão competente do país importador, não pela empresa: iv - certificado de uso/usuário final - cuf ou end user - documento oficial exigido pelo governo do país do exportador, que deve ser preenchido, assinado e timbrado por autoridade competente do governo do país do importador.",
                "End-User: E quando o produto não é controlado no país importador, qual documento apresento?": "Conforme item VI do art. 80 (Exportação) da portaria 1.729 de 29 de outubro de 2019, pode ser apresentada Carta da representação diplomática do país importador no Brasil, ou da respectiva representação diplomática brasileira, afirmando que o referido produto não necessita de Licença de Importação no país de destino.",
                "Tenho uma LI no status “Para Análise”. Devo solicitar a análise para quem?": "Conforme parágrafo 1º do art 7 da Portaria Colog 1729, a autorização prévia é concedida exclusivamente pela DFPC, em Brasília, e não pela Região Militar. A Região Militar é responsável somente pelo pós-embarque.",
                "Tenho uma carga urgente e quero ter prioridade no deferimento de minha licença. Devo solicitar a análise para quem?": "Não existe esta possibilidade. É seguido rigorosamente a fila de entrada dos processos. Conforme prazo legal, o órgão anuente responsável tem prazo vigente de 30 dias - LEI Nº 9.784, DE 29 DE JANEIRO DE 1999., Art. 49: Concluída a instrução de processo administrativo, a Administração tem o prazo de até trinta dias para decidir, salvo prorrogação por igual período expressamente motivada.",
                "Existem casos de prioridade em Licença de Importação (LI)?": "Os casos de prioridade são exclusivamente os previstos na Lei nº 10.048, de 8 de novembro de 2000 <a href='http://www.planalto.gov.br/ccivil_03/leis/l10048.htm' target='_blank'>Clique aqui</a>.",
                "Como realizou o agendamento para protocolo de processos sobre Comércio Exterior?": "Para procedimentos de agendamento no SFPC/2, acesse o endereço <a href='http://portalsfpc.2rm.eb.mil.br/index.php/agendar-atendimento' target='_blank'>Clique aqui</a>.",
                "Quais são os procedimentos e documentações necessárias à importação e exportação de produtos controlados (PCE)?": "Acesse o endereço: <a href='http://portalsfpc.2rm.eb.mil.br/index.php/comercio-exterior' target='_blank'>Clique aqui</a>.",
                "O que faço sobre exigências e pendências em processos de importação e exportação de produtos controlados - PCE (Comércio Exterior)?": "Visando a objetividade e tempestividade, o analista informará todas as exigências/pendências no processo de uma só vez ao interessado, justificando-se exigência posterior apenas em caso de dúvida superveniente. O usuário, reciprocamente, terá uma só oportunidade, por prazo expressamente definido, para solução das exigências/pendências informadas pelo analista. Assim, após uma primeira devolução no Siscomex, de processo sem a solução integral de todas as exigências/pendências, implicará seu imediato indeferimento, sem nova oportunidade de solução. Em caso de pendências em processo protocolado fisicamente, o interessado deverá imprimir o informe das pendências no SISPROT, anexando-o aos documentos e/ou esclarecimentos solicitados, e realizar o protocolo de tal documentação, sem necessidade de agendamento prévio, na Organização Militar responsável. O decurso do prazo definido para a solução de todas as exigências/pendências também implicará indeferimento do respectivo processo, a não ser que haja concessão de novo prazo, mediante solicitação do interessado previamente à data limite inicial. Questionamentos sobre exigências/pendências em processos, tramitados fisicamente ou pelo Siscomex, devem ser feitos exclusivamente via requerimento físico, com a exposição e a argumentação necessárias, devidamente assinado pelo interessado, com protocolo na Organização Militar da sua área de vinculação <a href='http://portalsfpc.2rm.eb.mil.br/index.php/servicos-da-denominacao' target='_blank'>Clique aqui</a>.",
                "O que faço sobre indeferimento de processo relativo a importação e exportação em Comércio Exterior?": "Visando a objetividade e tempestividade, o analista informará todas as exigências/pendências no processo de uma só vez ao interessado, justificando-se exigência posterior apenas em caso de dúvida superveniente. O usuário, reciprocamente, terá uma só oportunidade, por prazo expressamente definido, para solução das exigências/pendências informadas pelo analista. Assim, após uma primeira devolução no Siscomex, de processo sem a solução integral de todas as exigências/pendências, implicará seu imediato indeferimento, sem nova oportunidade de solução. O decurso do prazo definido para a solução de todas as exigências/pendências também implicará indeferimento do respectivo processo, a não ser que haja concessão de novo prazo, mediante solicitação do interessado previamente à data limite inicial. Pedidos de reconsideração de indeferimento de processos, tramitados fisicamente ou pelo Siscomex, devem ser feitos exclusivamente via requerimento físico, com a exposição e a argumentação necessárias, devidamente assinado pelo interessado, com protocolo na Organização Militar da sua área de vinculação <a href='http://portalsfpc.2rm.eb.mil.br/index.php/servicos-da-denominacao' target='_blank'>Clique aqui</a>."
            },
            "Blindagem": {
                "É necessário renovar o certificado de registro de Veículos blindados?": "Não, com a inclusão do parágrafo único do art. 106 do Código de Trânsito Brasileiro ('Quando se tratar de blindagem de veículo, não será exigido qualquer outro documento ou autorização para o registro ou o licenciamento'), como fica o controle do Exército sobre veículos blindados? Independentemente das recentes mudanças normativas impostas no CTB, consubstanciadas pelo DENATRAN (Portaria nº 428, de 13 de abril de 2021) e pelo CONTRAN (Deliberação nº 224, de 17 de maio de 2021), a Portaria nº 94-COLOG/2019 continua plenamente em vigor, permanecendo obrigatórios os procedimentos para blindagem de veículos automotores, com necessidade de Declaração de Blindagem na conclusão dos procedimentos.",
                "É necessário renovar o certificado de registro de Veículos blindados?": "Não, com a inclusão do parágrafo único do art. 106 do Código de Trânsito Brasileiro ('Quando se tratar de blindagem de veículo, não será exigido qualquer outro documento ou autorização para o registro ou o licenciamento'), como fica o controle do Exército sobre veículos blindados? Independentemente das recentes mudanças normativas impostas no CTB, consubstanciadas pelo DENATRAN (Portaria nº 428, de 13 de abril de 2021) e pelo CONTRAN (Deliberação nº 224, de 17 de maio de 2021), a <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG/2019</a> continua plenamente em vigor, permanecendo obrigatórios os procedimentos para blindagem de veículos automotores, com necessidade de Declaração de Blindagem na conclusão dos procedimentos.",
                "O Certificado de Registro para “utilização de veículo blindado” deixou de existir?": "Sim. Conforme art. 72 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, os certificados de registro emitidos sob a égide da <a href='http://www.dfpc.eb.mil.br/phocadownload/Portarian56.pdf' target='_blanck'>Portaria nº 55-COLOG</a>, de 5 de junho de 2017, para a atividade “utilização de veículo blindado”, serão cancelados, ex officio, por perda do objeto. Quando tal atividade estiver apostilada ao registro, esta deverá ser excluída por ocasião da sua revalidação.",
                "Blindagens balísticas (opaca ou transparente) podem ser vendidas ao proprietário de um veículo a ser blindado?": "Conforme §1º do art. 29 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a comercialização de blindagem balística é autorizada a pessoas jurídicas registradas no Exército e autorizadas a exercerem atividades com esse produto. Além disso, cumpre notar que, conforme art. 2º da <a href='http://www.dfpc.eb.mil.br/phocadownload/Portarian56.pdf' target='_blanck'>Portaria 56-COLOG</a>, de 5 de junho de 2017, para o exercício de qualquer atividade com PCE, própria ou terceirizada, as pessoas físicas ou jurídicas devem ser registradas no Exército. Logo, ratifica-se, as blindagens balísticas aplicadas em veículos blindados devem ser adquiridas por prestadoras de serviço devidamente registradas e autorizadas a exercerem atividades com os referidos produtos, e, por isso, sua comercialização jamais pôde ou poderá envolver o proprietário do veículo. Esclarecimentos: 1) Fabricantes e fornecedores não podem comercializar blindagens balísticas para pessoas não autorizadas, mas somente para pessoas jurídicas autorizadas a exercerem atividades com esse produto. 2) Uma vez que já estão aplicadas no veículo, as blindagens balísticas podem constar na descrição da nota fiscal de produtos, que necessariamente acompanha a nota fiscal de serviço, ambas faturadas ao cliente pela blindadora responsável. 3) Para uma concessionária/locadora que possui apostilada no registro a atividade “comércio de proteção balística\" para o produto 0460, sua aquisição só se dá pela finalidade de venda. Ou seja, o único destino das blindagens balísticas adquiridas por uma concessionária/locadora autorizada é a venda. Fazer do comércio um mero pressuposto para aquisição de qualquer PCE é deturpar a atividade autorizada pelo Exército, e isso não se permite.",
                "O serviço de blindagem pode ser iniciado sem a autorização de blindagem expedida pelo Exército?": "Não. Conforme art. 7º da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a prestação do serviço de blindagem em veículos deve ser precedida de autorização da Região Militar de vinculação da blindadora, por intermédio do SICOVAB.",
                "A declaração de idoneidade, cujo modelo é fornecido pelo Exército, possui validade?": "Sim, conforme anexo E da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a validade é de 60 dias, a contar da data de assinatura da declaração.",
                "Qual o prazo para conclusão do serviço de blindagem por parte da blindadora?": "Conforme art. 39 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a blindagem deve ocorrer em até 120 dias, a contar da data de autorização para blindagem. O não cumprimento desse prazo implicará a suspensão da abertura de novos processos de blindagem no SICOVAB.",
                "Após a conclusão da blindagem o veículo blindado pode ser retirado das instalações da blindadora?": "Conforme art. 39, §1º, da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a retirada do veículo blindado das instalações da blindadora só poderá acontecer mediante a expedição da Declaração de Blindagem.",
                "Veículo em processo de blindagem pode ter teto solar móvel?": "A <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, não dispõe sobre a maneira de aplicação de blindagem balística em parte alguma do veículo automotor, incluindo teto solar. Na referida portaria, a única obrigatoriedade quanto à aplicação é que o nível de proteção balística seja o mesmo em todo o veículo blindado, ressalvadas as viaturas de OSOP (vide art. 62). Assim, o teto solar, como qualquer peça, deverá ter o mesmo nível que as outras áreas do veículo. A obrigatoriedade de teto consistindo de “peça única e fixa” cessa com a revogação da <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Portaria nº 55-COLOG</a>, de 5 de junho de 2017 (60 dias após a publicação da <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019). Cumpre destacar que o Exército atribui a responsabilidade pelo serviço de blindagem diretamente ao proprietário da blindadora e a seu responsável técnico. É por isso que se exige um Termo de Responsabilidade de Blindagem assinado por ambos, indicando em mosaico o que e como foi aplicado de material balístico no veículo. Destaca-se, por fim, o art. 41 da <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019: Art. 41. O prestador de serviço responde, independentemente da existência de culpa, pela reparação dos danos causados aos consumidores por defeitos decorrentes de projeto, montagem, manipulação, apresentação ou acondicionamento de seus produtos, por informações insuficientes ou inadequadas sobre sua utilização e riscos, bem como quaisquer outras ocorrências que surgirem com o produto, na forma prevista no Código de Defesa do Consumidor.",
                "Quem pode ser o responsável técnico de uma blindadora?": "Conforme art. 11 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, o responsável técnico que assina o Termo de Responsabilidade deve estar regularmente registrado no Conselho Regional de Engenharia e Agronomia (CREA) e ter as atribuições previstas no art. 12 da <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Resolução nº 218-CONFEA</a>, de 29 de junho de 1973. Ou seja: ENGENHARIA MECÂNICA; ENGENHARIA MECÂNICA E DE AUTOMÓVEIS; ENGENHARIA MECÂNICA E DE ARMAMENTO; ENGENHARIA DE AUTOMÓVEIS; ENGENHARIA INDUSTRIAL MODALIDADE MECÂNICA; e ENGENHARIA DE PRODUÇÃO MECÂNICA (previsão na <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Resolução nº 288-CONFEA/1983</a>).",
                "É possível regularizar veículos antigos que foram blindados sem autorização do Exército?": "Sim. A <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, no art. 67, dá novo prazo para regularização: são 365 dias a partir da entrada em vigor da norma, isto é, de 19/10/2019 a 18/10/2020. A regularização está condicionada ao Laudo Técnico de Inspeção em Veículo emitido por blindadora regularmente registrada no Exército (não há obrigatoriedade de que a blindadora que emitirá o laudo técnico seja a mesma que efetivamente blindou o veículo).",
                "É autorizada a recuperação (“reprocessamento”, “reautoclavagem”) e reutilização de blindagens balísticas transparentes?": "Não. Conforme art. 62 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, é proibida a recuperação e posterior reutilização de blindagem balística aplicada em veículos, embarcações, aeronaves, estruturas arquitetônicas ou em viaturas de OSOP. As blindagens balísticas inservíveis ou com avarias, inclusive delaminação, devem ser destruídas.",
                "Para fins de autorização de blindagem, de venda e de transferência de propriedade de veículos blindados para pessoa jurídica, quem pode ser o 'representante legal'?": "Conforme Glossário da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, o representante legal é qualquer pessoa física, juridicamente capaz, devidamente nomeada em ato constitutivo, que possui poderes específicos e determinados para atuar em nome da empresa. Como exemplos: 1. no Contrato Social: sócio-proprietário ou algum administrador indicado no próprio contrato social; 2. no Estatuto Social: diretor eleito em assembleia, comprovado por Ata da Assembleia Geral; e 3. no Requerimento de Empresário Individual: o próprio empresário individual.",
                "Que documentos emitidos pelo Exército são necessários perante o DETRAN, para modificação de característica 'blindagem' no documento do veículo?": "Para pessoa física e pessoa jurídica de direito privado, o proprietário deve apresentar a Declaração de Blindagem expedida pelo Exército (conforme o tipo de regularização).",
                "Existe validade para as blindagens balísticas aplicadas em veículos?": "Não. O que pode existir é a garantia da blindadora, pela prestação do serviço de blindagem, e dos fabricantes, pelos materiais aplicados.",
                "É autorizada a blindagem de veículo estrangeiro?": "Sim, mas apenas veículos pertencentes a pessoas jurídicas, conforme art. 16, parágrafo único, da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019.",
                "É autorizada blindagem parcial de veículo?": "Conforme art. 66 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, o nível de proteção balística deve ser o mesmo em todo o veículo automotor blindado, ressalvadas as viaturas de órgãos de segurança e ordem pública (OSOP).",
                "A pessoa física que pretende comprar veículo automotor blindado usado deve pedir autorização de transferência de propriedade em qual Região Militar?": "Conforme art. 50 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a pessoa física deve solicitar a autorização no SFPC da Região Militar em que ele reside.",
                "O proprietário do veículo precisará portar algum documento expedido pelo Exército após o fim do “CR de utilização”?": "Não.",
                "É possível abrir um processo de origem “comércio” (blindagem para pronta-entrega) no SICOVAB indicando uma concessionária ainda sem CR?": "Não. O SICOVAB verificará automaticamente se o CNPJ tem acesso como concessionária, e, em caso negativo, não deixará prosseguir no processo.",
                "Qual o prazo dado pelo Exército para regularização de veículos antigos cuja blindagem não foi autorizada?": "Conforme art. 67 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, 365 dias a contar da entrada em vigor da Portaria nº 94-COLOG, de 16 de agosto de 2019. Ou seja: de 19/10/2019 a 18/10/2020.",
                "A regularização com laudo técnico de inspeção pode ser feita apenas pela blindadora responsável pela blindagem?": "A <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, não estabelece essa obrigação. Ou seja, mesmo que a blindadora responsável esteja ativa, a regularização pode ser feita por qualquer blindadora regularmente registrada no Exército. Em outras palavras: existindo ou não a blindadora que blindou, qualquer blindadora com registro ativo poderá fazer a regularização.",
                "A solicitação de autorização para transferência de propriedade de veículo blindado foi indeferida porque não consta “BLINDAGEM” no CRLV. O que fazer?": "Procurar uma blindadora com CR ativo para que ela faça a regularização com laudo técnico.",
                "O Exército permite terceirização do serviço de blindagem?": "Quanto ao controle e à fiscalização de produtos controlados, não há que se falar em terceirização de aplicação de blindagem balística em veículo automotor. O Exército Brasileiro dentro de sua competência não autoriza tal prática. Cumpre esclarecer que as blindadoras de veículos automotores devem exercer suas atividades com produtos controlados (PCE) estritamente no endereço constante do seu registro, excetuando-se a atividade-meio de armazenagem de PCE. Ou seja, a inclusão de segundo endereço a seu registro não autoriza nele atividade alguma a não ser o “depósito” de PCE. Dessa maneira, os procedimentos técnico-administrativos junto ao Exército, sobretudo aqueles realizados por meio do SICOVAB, são devidos à blindadora que, em suas próprias instalações, efetivamente realiza e supervisiona o serviço de blindagem.",
                "O Exército controla e fiscaliza a atividade de blindagem arquitetônica?": "Sim. Tal como a blindagem de veículos automotores, a blindagem arquitetônica é atividade controlada e fiscalizada pelo Exército, conforme prevê o § 7º do art. 39 do <a href='https://www.planalto.gov.br/ccivil_03/_Ato2019-2022/2019/Decreto/D10030.htm' target='_blanck'>Decreto nº 10.030</a>, de 30 de setembro de 2019. A legislação expedida pelo Exército especificamente sobre blindagem arquitetônica compreende a <a href='http://www.planalto.gov.br/ccivil_03/leis/l10248.htm'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, e a ITA nº 21-DFPC, de 17 de outubro de 2019.",
                "Estruturas arquitetônicas são consideradas Produtos Controlados pelo Exército (PCE)?": "Não, mas envolvem, em sua construção, a aplicação de blindagens balísticas, as quais são PCE.",
                "Quais documentos uma empresa presta serviço de blindagem arquitetônica deve ter para estar regular perante o Exército?": "A empresa que presta serviço de blindagem arquitetônica deve estar devidamente registrada no Exército, conforme prescreve a <a href='http://www.dfpc.eb.mil.br/phocadownload/Portarian56.pdf' target='_blanck'>Portaria nº 56-COLOG</a>, de 5 de junho de 2017; isto é, ela deve possuir Certificado de Registro (CR) ou Título de Registro (TR) ativo, estando nele previstas as atividades exercidas e os PCE correlatos.",
                "Blindagens balísticas (opaca ou transparente) podem ser vendidas diretamente ao contratante do serviço de blindagem arquitetônica?": "Conforme §1º do art. 29 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a comercialização de blindagem balística é autorizada a pessoas jurídicas registradas no Exército e autorizadas a exercerem atividades com esse produto. Além disso, cumpre notar que, conforme art. 2º da <a href='http://www.dfpc.eb.mil.br/phocadownload/Portarian56.pdf' target='_blanck'>Portaria 56-COLOG</a>, de 5 de junho de 2017, para o exercício de qualquer atividade com PCE, própria ou terceirizada, as pessoas físicas ou jurídicas devem ser registradas no Exército. Art. 2º Para o exercício de qualquer atividade com Produto Controlado pelo Exército (PCE), própria ou terceirizada, as pessoas físicas ou jurídicas devem ser registradas no Exército. Logo, ratifica-se, as blindagens balísticas aplicadas em estruturas arquitetônicas devem ser adquiridas por prestadoras de serviço devidamente registradas e autorizadas a exercerem atividades com os referidos produtos, e, por isso, sua comercialização jamais pôde ou poderá envolver o contratante do serviço.",
                "Perante o Exército, há penalidade para pessoa jurídica ou física que comercialize ou aplique produto tratado como blindagem balística, mas sem que este possua RAT/ReTEx ou Certificado de Conformidade?": "Sim, nos termos do “CAPÍTULO III - DA APLICAÇÃO DE PENALIDADE” do <a href='https://www.planalto.gov.br/ccivil_03/_Ato2019-2022/2019/Decreto/D10030.htm' target='_blanck'>Decreto nº 10.030</a>, de 30 de setembro de 2019. Além disso, cumpre notar o art. 41 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, a saber: Art. 41. O prestador de serviço responde, independentemente da existência de culpa, pela reparação dos danos causados aos consumidores por defeitos decorrentes de projeto, montagem, manipulação, apresentação ou acondicionamento de seus produtos, por informações insuficientes ou inadequadas sobre sua utilização e riscos, bem como quaisquer outras ocorrências que surgirem com o produto, na forma prevista no Código de Defesa do Consumidor.",
                "O contratante de blindagem arquitetônica deve exigir do prestador de serviço antes da contratação?": "Relativo ao Exército, o contratante pode solicitar que o prestador de serviço apresente, ao menos, os seguintes documentos: a) CR ou TR ativo, autorizando a atividade “PRESTAÇÃO DE SERVIÇO – APLICAÇÃO DE BLINDAGEM BALÍSTICA”; e b) Anotação de Responsabilidade Técnica (ART) válida assinada por Engenheiro Civil.",
                "O prestador de serviço de blindagem arquitetônica deve realizar algum procedimento técnico-administrativo para o Exército?": "Sim. Obrigatoriamente, a empresa deve cumprir todos os procedimentos do item “7” da ITA nº 21-DFPC, de 17 de outubro de 2019. Em suma, a prestadora do serviço deve informar dados das blindagens balísticas aplicadas, do local de aplicação e dos seu proprietário, bem como apresentar o 'Termo de Responsabilidade de Aplicação de Blindagem Balística', devidamente assinado por seu representante legal e seu responsável técnico. Todos os procedimentos ocorrem eletronicamente pelo Sistema de Controle de Veículos Automotores Blindados e Blindagens Balísticas (SICOVAB).",
                "O SICOVAB não é destinado somente a veículos blindados?": "Conforme o art. 1º da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, o nome do Sistema é 'Sistema de Controle de Veículos Automotores Blindados e Blindagens Balísticas (SICOVAB)'. Portanto, conforme o próprio nome, o SICOVAB se destina não só ao controle da blindagem automotiva, mas também de qualquer atividade envolvendo blindagens balísticas. Nisto, evidentemente, se enquadra o serviço de aplicação de blindagens balísticas em estruturas arquitetônicas.",
                "Após a conclusão da blindagem arquitetônica em determinada edificação, o que a prestadora do serviço deve disponibilizar ao contratante?": "A prestadora do serviço deve disponibilizar ao contratante (responsável pela edificação) o 'Termo de Responsabilidade de Aplicação de Blindagem Balística' referente à prestação do serviço, elaborado conforme o anexo A2 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019.",
                "Quais garantias que o usuário final pode exigir da prestadora do serviço de blindagem arquitetônica?": "O art. 41 da <a href='http://www.dfpc.eb.mil.br/images/Portaria94.pdf' target='_blanck'>Portaria nº 94-COLOG</a>, de 16 de agosto de 2019, prevê que 'o prestador de serviço responde, independentemente da existência de culpa, pela reparação dos danos causados aos consumidores por defeitos decorrentes de projeto, montagem, manipulação, apresentação ou acondicionamento de seus produtos, por informações insuficientes ou inadequadas sobre sua utilização e riscos, bem como quaisquer outras ocorrências que surgirem com o produto, na forma prevista no Código de Defesa do Consumidor.'",
                "Para comercializar blindagem balística é obrigatório possuir Título de Registro (TR)?": "Não necessariamente. Tem autorização para vender blindagem balística qualquer pessoa jurídica registrada no Exército com a atividade “COMÉRCIO DE PROTEÇÃO BALÍSTICA” especificando o produto blindagem balística opaca ou transparente, de uso permitido ou restrito. Ou seja, se a pessoa jurídica possui Certificado de Registro (CR) nestas condições, a venda é lícita no que compete ao controle e à fiscalização pelo Exército. Desta forma, a exigência taxativa de TR para venda de blindagem balística opaca não encontrará lugar na legislação atinente a PCE.",
                "É autorizada a recuperação (“reprocessamento”, “reautoclavagem”) e reutilização de blindagens balísticas transparentes?": "Não. Conforme art. 62 da Portaria nº 94-COLOG, de 16 de agosto de 2019, é proibida a recuperação e posterior reutilização de blindagem balística aplicada em veículos, embarcações, aeronaves, estruturas arquitetônicas ou em viaturas de OSOP. As blindagens balísticas inservíveis ou com avarias, inclusive delaminação, devem ser destruídas.",
                "Aço é considerado PCE do tipo “proteção balística”?": "A aplicação de aço como blindagem balística deve levar em conta a existência ou não de RAT/ReTEx ou Certificado de Conformidade. Se o aço possui RAT/ReTEx ou Certificado de Conformidade, então é considerado PCE do tipo “PROTEÇÃO BALÍSTICA”. Se não o possui, então o aço não é considerado PCE, e, do ponto de vista técnico da avaliação, não pode ser tratado como blindagem balística, ainda que, pela constituição ou espessura, demonstre alguma propriedade de resistência balística.",
            },
            "Guia de Tráfego": { 
                "Como faço para minha empresa ter condições de emitir guia de tráfego?":"Acesse este link para visualizar o passo a passo. <a href='https://portalsfpc.2rm.eb.mil.br/index.php/menu-guia-pj/232-cadastro-de-usuario-para-emissao-de-gt' target='_blanck'>Clique aqui</a>",
                "Como faço para solicitar selos pessoa jurídica para emitir guia de tráfego?":"Acesse este link para visualizar o passo a passo. <a href='https://portalsfpc.2rm.eb.mil.br/index.php/menu-guia-pj/231-solicitar-selo-de-autenticidade' target='_blanck'>Clique aqui</a>",
                "Quais as finalidades de guia de tráfego através do SisGCorp?":"EXPORTAÇÃO DEFINITIVA; EXPORTAÇÃO TEMPORÁRIA;  MANUTENÇÃO DO PCE; EXPOSIÇÃO DE COLEÇÃO NO PAÍS; MUDANÇA DE LOCAL DE ACERVO; ATIADOR/CAÇA: CONTROLE DE FAUNA EXOTICA INVASORA."
            },
            "SICOEx": { 
                "Quais são as distâncias de segurança (distâncias seguras) para armazenamento?":"Relação de Produtos Controlados pelo Exército (PCE) que requerem distâncias de segurança para armazenamento, especificando a Tabela de Segurança da Portaria nº 147-COLOG, de 21 de novembro de 2019, correspondente;",
                "Além do cumprimento de distâncias de segurança, há também regras sobre compatibilidade química para os grupos de explosivos?":"Além da necessidade de cumprimento de distâncias de segurança, há também regras sobre compatibilidade química para os grupos de explosivos previstos no Anexo I da Portaria nº 118-COLOG, de 04 de outubro de 2019."
            }


        };


        // Variável para controlar se o chatbot está exibindo sugestões de tópicos (inicialmente não)
        bestMatchTwoZeroResponse = 0;
        let showingTopics = false;
        let showingQuestions = false;

        // Função para listar os tópicos disponíveis (categorias)
        function listTopics() {
            let message = "<strong>Lista de tópicos disponíveis:</strong><br>";
            let index = 1;

            // Loop por todas as categorias do objeto 'rules'
            for (const category in rules) {
                message += `${index}. ${category}<br>`; // Adiciona o nome do tópico à mensagem
                index++;
            }

            // Instrução adicional para o usuário escolher o número do tópico
            message += `<div class="follow-up">Digite o número do tópico desejado para ver as perguntas e respostas correspondentes.</div>`;

            // Define que o chatbot está mostrando os tópicos
            showingTopics = true;

            // Retorna a mensagem formatada com os tópicos
            return message;
        }

        function listQuestions(topicIndex) {
            const topics = Object.keys(rules); // Pega os nomes dos tópicos
            const selectedTopic = topics[topicIndex - 1]; // Ajusta índice (usuário escolhe a partir de 1)

            if (!selectedTopic) {
                return "<strong>Erro:</strong> Tópico inválido. Escolha um número da lista.";
            }

            let message = `<strong>Perguntas sobre: ${selectedTopic}</strong><br>`;
            let index = 1;

            // Lista todas as perguntas do tópico selecionado
            for (const question in rules[selectedTopic]) {
                message += `${index}. ${question}<br>`;
                index++;
            }

            // Instrução para o usuário selecionar uma pergunta específica
            message += `<div class="follow-up">Digite o número da pergunta desejada para ver a resposta.</div>`;

            // Define variável para armazenar o tópico atualmente exibido
            currentTopic = selectedTopic;

            return message;
        }


        // Função para exibir as perguntas e respostas de um tópico específico, com base no número escolhido pelo usuário
        function showQuestionsByTopic(index) {
            const categories = Object.keys(rules); // Lista todas as categorias (tópicos)
            const topicIndex = parseInt(index, 10) - 1; // Converte o índice recebido para número inteiro

            // Verifica se o índice informado é válido
            if (isNaN(topicIndex) || topicIndex < 0 || topicIndex >= categories.length) {
                return "Número inválido. Por favor, escolha um dos números listados.";
            }

            // Recupera a categoria selecionada com base no índice
            const selectedCategory = categories[topicIndex];
            const questions = rules[selectedCategory]; // Objeto com perguntas e respostas do tópico selecionado
            let message = `<strong>${selectedCategory}:</strong><br>`;

            // Adiciona cada pergunta e resposta na mensagem
            for (const question in questions) {
                message += `<br><strong>Q:</strong> ${question}<br><strong>R:</strong> ${questions[question]}<br>`;
            }

            // Marca que não está mais exibindo os tópicos e reseta controle
            showingTopics = false;
            bestMatchTwoZeroResponse = 0;

            // Retorna mensagem com perguntas e respostas do tópico selecionado
            return message;
        }

        /**
     * Calcula a distância de Levenshtein entre duas palavras.
     * Essa métrica mede o número mínimo de operações (inserções, deleções e substituições)
     * necessárias para transformar uma string na outra.
     */
        function levenshteinDistance(a, b) {
            // Cria uma matriz (tabela) com dimensões [a.length+1][b.length+1] preenchida com zeros
            const matrix = Array.from({ length: a.length + 1 }, (_, i) => Array(b.length + 1).fill(0));

            // Inicializa a primeira coluna da matriz com valores crescentes (0 a a.length)
            for (let i = 0; i <= a.length; i++) matrix[i][0] = i;

            // Inicializa a primeira linha da matriz com valores crescentes (0 a b.length)
            for (let j = 0; j <= b.length; j++) matrix[0][j] = j;

            // Preenche o restante da matriz com base na comparação dos caracteres
            for (let i = 1; i <= a.length; i++) {
                for (let j = 1; j <= b.length; j++) {
                    // Define o custo: 0 se os caracteres forem iguais, 1 se diferentes
                    const cost = a[i - 1] === b[j - 1] ? 0 : 1;

                    // Calcula o valor mínimo entre: remoção, inserção ou substituição
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,       // Remoção
                        matrix[i][j - 1] + 1,       // Inserção
                        matrix[i - 1][j - 1] + cost // Substituição
                    );
                }
            }

            // Retorna a distância de Levenshtein entre as duas palavras
            return matrix[a.length][b.length];
        }

        /**
         * Extrai palavras-chave de uma string removendo espaços e convertendo para minúsculas.
         * Apenas palavras com mais de 2 caracteres são consideradas.
         */
        function extractKeywords(text) {
            // Converte para minúsculas, divide por espaço e filtra palavras com mais de 2 letras
            return text.toLowerCase().split(" ").filter(word => word.length > 2);
        }

        /**
         * Encontra a melhor correspondência para a pergunta do usuário.
         * Utiliza a distância de Levenshtein para permitir pequenos erros de digitação.
         */
        function findBestMatch(userText) {
            // Extrai palavras-chave da pergunta do usuário
            const userKeywords = extractKeywords(userText);

            // Inicializa a melhor correspondência encontrada
            let bestMatch = { question: "", answer: "", score: 0 };

            // Percorre todas as categorias de perguntas no objeto rules
            for (const category in rules) {
                // Percorre cada pergunta dentro da categoria
                for (const question in rules[category]) {
                    // Extrai palavras-chave da pergunta cadastrada
                    const questionKeywords = extractKeywords(question);
                    let score = 0;

                    // Compara cada palavra-chave digitada com cada palavra da pergunta cadastrada
                    userKeywords.forEach(userWord => {
                        questionKeywords.forEach(questionWord => {
                            // Calcula a distância de Levenshtein entre as palavras
                            const distance = levenshteinDistance(userWord, questionWord);

                            // Se forem iguais ou semelhantes (distância <= 2 e palavra com mais de 3 letras), aumenta o score
                            if (distance === 0 || (distance <= 2 && questionWord.length > 3)) {
                                score++;
                            }
                        });
                    });

                    // Atualiza o melhor match se o score atual for maior
                    if (score > bestMatch.score) {
                        bestMatch = {
                            question: question,
                            answer: rules[category][question],
                            score: score
                        };
                    }
                }
            }

            // Retorna a melhor correspondência encontrada
            return bestMatch;
        }

        function findBestMatches(userText) {
            const userKeywords = extractKeywords(userText);
            const matches = [];

            for (const category in rules) {
                for (const question in rules[category]) {
                    const questionKeywords = extractKeywords(question);
                    let score = 0;

                    userKeywords.forEach(userWord => {
                        questionKeywords.forEach(questionWord => {
                            const distance = levenshteinDistance(userWord, questionWord);
                            if (distance === 0 || (distance <= 2 && questionWord.length > 3)) {
                                score++;
                            }
                        });
                    });

                    // Só adiciona se o score for maior que zero
                    if (score > 0) {
                        matches.push({
                            question: question,
                            answer: rules[category][question],
                            score: score
                        });
                    }
                }
            }

            // Ordena do maior para o menor score
            matches.sort((a, b) => b.score - a.score);

            // Retorna os quatro melhores (ou menos, se houver menos que 4 com score > 0)
            return matches.slice(0, 3);
        }


        /**
         * Envia a mensagem quando o usuário pressiona "Enter".
         */
        function handleKeyPress(event) {
            // Se a tecla pressionada for "Enter"
            if (event.key === "Enter") {
                sendMessage(); // Envia a mensagem
            }
        }

        // Adiciona um ouvinte de evento ao campo de entrada para detectar pressionamento da tecla Enter
        document.getElementById("userInput").addEventListener("keypress", handleKeyPress);

        /**
         * Função para obter uma saudação com base no horário do dia.
         * Exemplo: "Bom dia", "Boa tarde" ou "Boa noite".
         */
        function getGreeting() {
            const hour = new Date().getHours(); // Obtém a hora atual (0–23)

            // Retorna a saudação apropriada de acordo com a hora
            if (hour < 12) {
                return "Bom dia";
            } else if (hour < 18) {
                return "Boa tarde";
            } else {
                return "Boa noite";
            }
        }



        /**
  * Função que retorna uma mensagem de boas-vindas aleatória.
  * Existem várias opções de mensagens para dar a impressão de interações diferentes.
  */
        function getRandomWelcomeMessage() {
            // Lista de mensagens de boas-vindas
            const welcomeMessages = [
                "Como posso ajudar?",
                "Tudo bem? Como posso ser útil?",
                "Seja bem-vindo! O que posso fazer por você?",
                "Como posso te ajudar neste dia?",
                "Em que posso te ajudar hoje?",
                "Como posso te ajudar?",
                "O que posso fazer por você?",
                "Bem-vindo ao nosso chat! Como posso te auxiliar?",
                "Como posso ajudar você com suas dúvidas?",
                "Em que posso ser útil para você hoje?"
            ];

            // Retorna uma das mensagens aleatoriamente
            return welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
        }

        /**
         * Função que exibe a saudação de boas-vindas assim que a página é carregada.
         * Inclui uma saudação com base no horário do dia.
         */
        function displayWelcomeMessage(customMessage = "") {
            const chatbox = document.getElementById("chatbox");
            const greeting = getGreeting();

            // Garantindo que customMessage seja uma string válida antes de aplicar o trim
            const messageToUse = (customMessage && typeof customMessage === "string" && customMessage.trim() !== "")
                ? customMessage
                : `${greeting}! ` + getRandomWelcomeMessage();

            const welcomeMessage = `${messageToUse} <br><br><strong>Aqui estão os tópicos que podem ajudar:</strong><br><br>${listTopics()}`;

            chatbox.innerHTML += `<div class="bot-message"><span class="emoji-bot">🤖</span> <strong>Bot:</strong> ${welcomeMessage}</div>`;
            chatbox.scrollTop = chatbox.scrollHeight;
            document.getElementById("userInput").focus();
        }





        // Exibe a mensagem de boas-vindas quando a página for carregada
        window.onload = displayWelcomeMessage;

        /**
         * Função que sanitiza a entrada do usuário, evitando execução de código HTML.
         */
        function sanitizeInput(input) {
            const div = document.createElement('div'); // Cria elemento temporário
            div.textContent = input; // Define o texto puro (sem HTML)
            return div.innerHTML; // Retorna o texto com caracteres escapados
        }


        let userFeedbacks = {}; // Armazenar perguntas e feedbacks

        function sendMessage() {
            const inputField = document.getElementById("userInput");
            const chatbox = document.getElementById("chatbox");
            let userText = inputField.value.trim();

            if (!userText) return;

            userText = sanitizeInput(userText);

            let numeroAleatorioUserMessage = Math.floor(Math.random() * 10000);

            const userMessageDiv = document.createElement('div');
            userMessageDiv.id = numeroAleatorioUserMessage;
            userMessageDiv.classList.add('user-message');
            userMessageDiv.innerHTML = `🙋 <strong>Você:</strong> ${userText}`;
            chatbox.appendChild(userMessageDiv);

            let botResponse = "";
            let followUpText = "";
            let followUpTextComplement = "";
            let showFeedback = false;

            // Verifica se é um número e busca por tópicos ou perguntas
            if (/^\d+$/.test(userText)) {
                if (showingTopics || showingQuestions) {
                    botResponse = showQuestionsByTopic(userText);
                    showFeedback = true;
                } else {
                    const bestMatches = findBestMatches(userText);
                    if (bestMatches.length > 0) {
                        const bestMatch = bestMatches[0];
                        if (bestMatch.answer !== "Liste todos os tópicos") {
                            botResponse = "<strong>" + bestMatch.answer + "</strong>";
                            followUpText = `🔍 <em>Caso esteja se referindo à pergunta:</em> "<strong>${bestMatch.question}</strong>"<br>`;
                            showFeedback = true;

                            if (bestMatches.length > 1) {
                                followUpTextComplement += `<br><br><em>Pode ser interessante ainda:</em><ul>`;
                                bestMatches.slice(1, 4).forEach(match => {
                                    followUpTextComplement += `<li>"<strong>${match.question}</strong> ${match.answer}"</li>`;
                                });
                                followUpTextComplement += `</ul>`;
                            }
                        }
                    } else {
                        botResponse = "Desculpe, não tenho uma resposta para essa pergunta. Por favor, pergunte-me sobre assuntos relacionados ou, se preferir, envie-nos uma mensagem através de nosso 'Fale Conosco'.";
                        botResponse += "<br><br>" + listTopics();
                        showFeedback = true;
                    }
                }
            } else {
                // Para texto livre (não numérico)
                const bestMatches = findBestMatches(userText);
                if (bestMatches.length > 0) {
                    const bestMatch = bestMatches[0];
                    if (bestMatch.answer !== "Liste todos os tópicos") {
                        botResponse = "<strong>" + bestMatch.answer + "</strong>";
                        followUpText = `🔍 <em>Caso esteja se referindo à pergunta:</em> "<strong>${bestMatch.question}</strong>"<br>`;
                        showFeedback = true;

                        if (bestMatches.length > 1) {
                            followUpTextComplement += `<br><br><em>Pode ser interessante ainda:</em><ul>`;
                            bestMatches.slice(1, 4).forEach(match => {
                                followUpTextComplement += `<li>"<strong>${match.question}</strong> ${match.answer}"</li>`;
                            });
                            followUpTextComplement += `</ul>`;
                        }
                    }
                } else {
                    botResponse = "Desculpe, não tenho uma resposta para essa pergunta. Por favor, pergunte-me sobre assuntos relacionados ou, se preferir, envie-nos uma mensagem através de nosso 'Fale Conosco'.";
                    botResponse += "<br><br>" + listTopics();
                    showFeedback = true;
                }
            }

            const numeroAleatorioBotMessage = Math.floor(Math.random() * 10000);
            const botMessageDiv = document.createElement('div');
            botMessageDiv.id = numeroAleatorioBotMessage;
            botMessageDiv.classList.add('bot-message');
            botMessageDiv.innerHTML = `<span class="emoji-bot">🤖</span> <strong>Bot:</strong><br>${followUpText} 💡 <em>Resposta:</em> ${botResponse} ${followUpTextComplement}`;
            chatbox.appendChild(botMessageDiv);

            // Adicionando a pergunta de feedback SOMENTE SE FOR RESPOSTA REAL
            if (showFeedback) {
                const feedbackDiv = document.createElement('div');
                feedbackDiv.classList.add('feedback-message');
                feedbackDiv.innerHTML = `<strong>🤔</strong> A resposta fornecida ou as questões listadas ajudaram a resolver sua dúvida? <button onclick="submitFeedback(true, '${userText}')">Sim</button> <button onclick="submitFeedback(false, '${userText}')">Não</button>`;
                chatbox.appendChild(feedbackDiv);
            }

            botMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            inputField.value = "";

            setTimeout(() => {
                const lastUserMessageDiv = document.getElementById(`${numeroAleatorioUserMessage}`);
                const lastBotMessageDiv = document.getElementById(`${numeroAleatorioBotMessage}`);
                lastUserMessageDiv.classList.remove("fade-in");
                lastBotMessageDiv.classList.remove("fade-in");
            }, 1000);
        }

        function submitFeedback(isResolved, userQuestion) {
            const feedbackMessage = isResolved ? "Que bom que consegui te ajudar!" : "Sinto muito, vou tentar melhorar as respostas! Por favor, registre um chamado em nosso Fale Conosco.";

            // Armazenando o feedback para a pergunta
            userFeedbacks[userQuestion] = isResolved ? 'Sim' : 'Não';

            const feedbackDiv = document.createElement('div');
            feedbackDiv.classList.add('feedback-response');
            feedbackDiv.innerHTML = `<span class="emoji-bot">🤖</span> <strong>Bot:</strong> ${feedbackMessage}`;
            document.getElementById("chatbox").appendChild(feedbackDiv);

            // Exibe o feedback e continua com a interação
            feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            displayWelcomeMessage("Caso haja mais dúvidas, é só me perguntar ou escolher os tópicos abaixo.");
        }

        // Função que exibe os feedbacks armazenados
        function showUserFeedbacks() {
            const feedbackContainer = document.createElement('div');
            feedbackContainer.classList.add('feedback-container');

            let feedbackContent = '<h3>Feedbacks do Usuário:</h3>';

            if (Object.keys(userFeedbacks).length === 0) {
                feedbackContent += "<p><em>Não há feedbacks registrados ainda.</em></p>";
            } else {
                Object.keys(userFeedbacks).forEach(question => {
                    const feedback = userFeedbacks[question];
                    feedbackContent += `
                <p><strong>Pergunta:</strong> "${question}"</p>
                <p><strong>Feedback:</strong> ${feedback}</p>
                <hr>
            `;
                });
            }

            feedbackContainer.innerHTML = feedbackContent;

            // Exibe os feedbacks na interface do chat
            const chatbox = document.getElementById("chatbox");
            chatbox.appendChild(feedbackContainer);

            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }


    </script>
</body>

</html>